(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{129:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),i=a(126),r=a(74),l=a(41),o=a(44),c=a(66),d=a(51),m=a(130);class h extends n.a.Component{delete(){this.props.delete(this.props.time)}render(){return n.a.createElement(c.a,null,n.a.createElement(d.a,{className:"d-flex justify-content-start pb-3"},n.a.createElement(m.a,{className:"shadow rounded d-flex align-items-center"},n.a.createElement(m.a.Title,null,this.props.text),n.a.createElement(r.a,{onClick:this.delete.bind(this)},"Delete."))))}}class p extends h{accept_invite(e){this.delete(),Object(o.d)("/team/join/"+e.toString()+"/").then(()=>{}).catch(()=>{})}decline_invite(e){this.delete(),Object(o.d)("/team/decline/"+e.toString()+"/").then(()=>{}).catch(()=>{})}render(){return console.log("Render team notification"),n.a.createElement(c.a,null,n.a.createElement(d.a,{className:"d-flex justify-content-start pb-3"},n.a.createElement(m.a,{className:"shadow rounded d-flex align-items-center"},n.a.createElement(m.a.Title,null,this.props.text),n.a.createElement(c.a,null,n.a.createElement(d.a,null,n.a.createElement(r.a,{onClick:()=>this.accept_invite(this.props.id)},"Accept!"),n.a.createElement(r.a,{onClick:()=>this.decline_invite(this.props.id)},"Decline."))))))}}class u extends h{accept_invite(e){this.delete(),Object(o.d)("/users/profile/friends/accept/"+e.toString()+"/").then(()=>{this.props.friends_update()}).catch(()=>{})}decline_invite(e){this.delete(),Object(o.d)("/users/profile/friends/decline/"+e.toString()+"/").then(()=>{}).catch(()=>{})}render(){return console.log("Render friend notification"),n.a.createElement(c.a,null,n.a.createElement(d.a,{className:"d-flex justify-content-start pb-3"},n.a.createElement(m.a,{className:"shadow rounded d-flex align-items-center"},n.a.createElement(m.a.Title,null,this.props.text),n.a.createElement(c.a,null,n.a.createElement(d.a,null,n.a.createElement(r.a,{onClick:()=>this.accept_invite(this.props.id)},"Accept!"),n.a.createElement(r.a,{onClick:()=>this.decline_invite(this.props.id)},"Decline."))))))}}class f extends n.a.Component{constructor(e){super(e),this.ws_unmounted=!1,this.ws_server=()=>{Object(o.d)("/server_config/").then(e=>{let t=new WebSocket(e.data.notification);t.onopen=()=>{t.send(JSON.stringify(localStorage.getItem("token"))),console.log("connected"),Object(o.d)("/notification/retrieve/").then(()=>{}).catch(()=>{}),this.setState({error:""})},t.onmessage=e=>{let t=JSON.parse(e.data),a=h,s=t.text||"DEFAULT TEXT",i=!0;if(console.log(t.type),"invited to team"==t.type?(s="You have been invited to a team by "+t.inviter_name,a=p):"new teammate"==t.type?(s=t.teammate_name+" has joined your team!",this.props.set_party()):"already invited to team"==t.type?s="That player has already been invited to your team!":"already in team"==t.type?s="That player is already in your team!":"team joined"==t.type?(s="You've joined a new team!",this.props.set_party()):"kicked from team"==t.type?(s="You have been kicked from your team.",this.props.set_party()):"teammate kicked"==t.type?(s=t.teammate_name+" has been kicked from your team.",this.props.set_party()):"teammate left"==t.type?(s=t.teammate_name+" has left your team.",this.props.set_party()):"left team"==t.type?(s="You have left your team.",this.props.set_party()):"not the leader"==t.type?s="You are not the leader":"invitation declined"==t.type?s=t.username+" has declined your invitation":"friend online"==t.type?(i=!1,this.update_friend(t.id,!0)):"friend offline"==t.type?(i=!1,this.update_friend(t.id,!1)):"friend invite"==t.type?(s=t.username+" has sent you a friend request!",a=u):"friend invite sent"==t.type?s="Sent friend invite to "+t.username:"friend invite accepted"==t.type?(s=t.username+" has accepted your friend request!",this.props.update_friends()):"friend invite declined"==t.type?s=t.username+" has declined your friend request.":"already in friends"==t.type?s=t.username+" is already in your friend list!":"already in friend invites"==t.type?s="You have already invited "+t.username+" to your friends!":"removed from friends"==t.type?(s=t.username+" has removed you from their friend list. :(",this.props.update_friends()):"starting game"==t.type&&(i=!1,o.c.address=t.address,this.props.begin_game()),!i)return;let r=n.a.createElement(a,{id:"id"in t?t.id:0,text:s,delete:this.delete.bind(this),friends_update:this.props.update_friends,time:Date.now()});this.setState({notifications:[...this.state.notifications,r]})},t.onclose=e=>{this.ws_unmounted||setTimeout(this.ws_server,1e4)},t.onerror=e=>{setTimeout(this.ws_server,1e4),this.setState({error:"Can't connect to notification service."})}}).catch(e=>{console.log(e)})},this.state={notifications:[],notification_socket:null,error:""},this.delete=this.delete.bind(this)}delete(e){this.setState({notifications:this.state.notifications.filter(t=>t.props.time!=e)})}update_friend(e,t){this.props.update_friend(e,t)}componentWillUnmount(){this.ws_unmounted=!0,this.state.notification_socket&&this.state.notification_socket.close()}componentDidMount(){this.ws_server()}render(){return this.state.error?n.a.createElement("h1",null,this.state.error):n.a.createElement(n.a.Fragment,null,this.state.notifications.sort((e,t)=>t.props.time-e.props.time).map((e,t)=>n.a.createElement("div",{key:t},e," ")))}}var _=a(69),y=a(70),v=a(46),g=a.n(v);class E extends n.a.Component{constructor(){super(...arguments),this.invite_friend=e=>{console.log("sending invite"),g.a.get(o.a+"/team/invite/"+e.toString(),{headers:{Authorization:"Token "+localStorage.getItem("token")}}).then(()=>{}).catch(e=>{console.log(e)})},this.remove_friend=e=>{Object(o.d)("/users/profile/friends/remove/"+e.toString()+"/").then(()=>{this.props.update_friends()}).catch(()=>{})}}timeSince(e){let t=Math.floor(e/31536e3);return t>1?t+"y":(t=Math.floor(e/2592e3),t>1?t+"mt":(t=Math.floor(e/86400),t>1?t+"d":(t=Math.floor(e/3600),t>1?t+"h":(t=Math.floor(e/60),t>1?t+"m":Math.floor(e)+"s"))))}render(){const{username:e,last_seen:t,id:a,is_online:s}=this.props.friends;return s?n.a.createElement("div",{className:"friend_container p-2 rounded"},n.a.createElement("div",{className:"friend_info"},"🟢 ",e),n.a.createElement("div",{className:"friend_menu"},n.a.createElement(_.a,{className:"remove_icon",size:"1x",icon:y.c,onClick:()=>this.remove_friend(a)}),n.a.createElement(_.a,{className:"invite_icon",size:"1x",icon:y.a,onClick:()=>this.invite_friend(a)}))):n.a.createElement("div",{className:"friend_container p-2 rounded"},n.a.createElement("div",{className:"friend_info"},"⚫ ",e),n.a.createElement("div",{className:"friend_menu"},n.a.createElement(_.a,{className:"remove_icon",size:"1x",icon:y.c,onClick:()=>this.remove_friend(a)}),n.a.createElement("span",{style:{paddingRight:"5px"}},this.timeSince(t))))}}class b extends n.a.Component{render(){return n.a.createElement(n.a.Fragment,null,this.props.friends.filter(e=>e.is_online).map(e=>n.a.createElement(c.a,{key:e.id},n.a.createElement(d.a,{className:"d-flex justify-content-start pb-3"},n.a.createElement(E,{friends:e,update_friends:this.props.update_friends})))),this.props.friends.filter(e=>!e.is_online).map(e=>n.a.createElement(c.a,{key:e.id},n.a.createElement(d.a,{className:"d-flex justify-content-start pb-3"},n.a.createElement(E,{friends:e,update_friends:this.props.update_friends})))))}}class k extends n.a.Component{kick_member(e){Object(o.d)("/team/kick/"+e.toString()).then(()=>{}).catch(e=>{console.log(e.data)})}leave_team(){Object(o.d)("/team/leave/").then(e=>{console.log(e.data)}).catch(e=>{console.log(e.data)})}render(){return console.log(this.props.party,this.props.leader),this.props.leader?this.props.user_nick==this.props.leader.username?n.a.createElement("div",{className:"party_container"},n.a.createElement("div",{key:0,className:"d-flex justify-content-center shadow-sm p-2 rounded party_member"},"⭐",this.props.leader.username),this.props.party.filter(e=>e.username!=this.props.leader.username).map((e,t)=>n.a.createElement("div",{key:t+1,className:"d-flex justify-content-center shadow-sm p-2 rounded party_member"},e.username,n.a.createElement(_.a,{className:"kick_icon",size:"1x",icon:y.b,onClick:this.kick_member.bind(this,e.id)}))),this.props.party.length>1?n.a.createElement("div",{className:"d-flex justify-content-center"},n.a.createElement(r.a,{variant:"dark",size:"sm",onClick:this.leave_team},"Leave")):n.a.createElement(n.a.Fragment,null)):n.a.createElement("div",{className:"party_container"},n.a.createElement("div",{key:0,className:"d-flex justify-content-center shadow-sm p-2 rounded party_member"},"⭐",this.props.leader.username),this.props.party.filter(e=>e.username!=this.props.leader.username).map((e,t)=>n.a.createElement("div",{key:t+1,className:"d-flex justify-content-center shadow-sm p-2 rounded party_member"},e.username)),this.props.party.length>1?n.a.createElement("div",{className:"d-flex justify-content-center"},n.a.createElement(r.a,{variant:"dark",size:"sm",onClick:this.leave_team},"Leave")):n.a.createElement(n.a.Fragment,null)):n.a.createElement("div",{className:"party_container"},n.a.createElement("div",{className:"d-flex justify-content-center shadow-sm p-2 rounded party_member"},"⭐",this.props.user_nick))}}var x=a(111),N=a(112);class w extends n.a.Component{constructor(){super(...arguments),this.state={messages:[],chat_server:null,error:"",connecting:!0},this.ws_unmounted=!1,this.ws_server=()=>{Object(o.d)("/server_config/").then(e=>{this.setState({connecting:!0});let t=new WebSocket(e.data.chat);this.setState({chat_server:t}),t.onopen=()=>{this.setState({connecting:!1,error:""})},t.onmessage=e=>{let t=JSON.parse(e.data);if(this.state.messages.length&&this.state.messages[this.state.messages.length-1].name==t.name){let e=this.state.messages;e[e.length-1].text+="\n"+t.text,this.setState({messages:e})}else this.setState({messages:[...this.state.messages,t]})},t.onclose=e=>{this.ws_unmounted||setTimeout(this.ws_server,1e4)},t.onerror=e=>{setTimeout(this.ws_server,1e4),this.setState({connecting:!1,error:"Connection failed :("})}}).catch(e=>{console.log(e)})},this.chatSendMessage=e=>{Object(o.f)("/chat/send/",{message:e}).then(e=>{console.log(e.data)}).catch(e=>{console.log(e)})},this.handleKeyDown=e=>{"Enter"===e.key&&""!=e.target.value&&(this.chatSendMessage(e.target.value),e.target.value="")}}hashCode(e){for(var t=0,a=0;a<e.length;a++)t=e.charCodeAt(a)+((t<<5)-t);return t}intToRGB(e){var t=(16777215&e).toString(16).toUpperCase();return"00000".substring(0,6-t.length)+t}componentWillUnmount(){this.ws_unmounted=!0,this.state.chat_server&&this.state.chat_server.close()}componentDidMount(){this.ws_server()}render(){return this.state.connecting?n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,"Connecting..."),n.a.createElement("div",{className:"input_holder",style:{position:"absolute",bottom:"0px",left:"0px"}},n.a.createElement("input",{disabled:!0,type:"text",placeholder:"Send message!",onKeyDown:this.handleKeyDown.bind(this)}))):this.state.error?n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,this.state.error),n.a.createElement("div",{className:"input_holder",style:{position:"absolute",bottom:"0px",left:"0px"}},n.a.createElement("input",{disabled:!0,type:"text",placeholder:"Send message!",onKeyDown:this.handleKeyDown.bind(this)}))):n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"chat_messages"},n.a.createElement("div",{className:"scrollable-wrapper",style:{maxHeight:"100%"}},n.a.createElement(x.a,null,this.state.messages.map((e,t)=>n.a.createElement("div",{className:"message_container",key:t},n.a.createElement("div",{className:"message_name",style:{borderRight:"1px solid #"+this.intToRGB(this.hashCode(e.name)).toString()}},e.name),n.a.createElement("div",{className:"message_text"},e.text.split("\n").map((e,t)=>n.a.createElement("div",{key:t},n.a.createElement(N.Twemoji,{text:e}))))))))),n.a.createElement("div",{className:"input_holder"},n.a.createElement("input",{type:"text",placeholder:"Send message!",onKeyDown:this.handleKeyDown.bind(this)})))}}class S extends n.a.Component{constructor(e){super(e),this.state={modal_visiblity:"none",user_exists:!1,id:null,typingTimer:null,typingTimeout:500,usernameInputRef:null,invite_button_disabled:!0},this.onChange=e=>{let t=e.target.value.toString();clearTimeout(this.state.typingTimer),t&&(this.state.typingTimer=setTimeout(()=>{this.checkUserExists(t)},this.state.typingTimeout))},this.handleKeyDown=e=>{"Enter"!==e.key||this.state.invite_button_disabled||this.sendInvite()},this.checkUserExists=e=>{e!=this.props.nick&&Object(o.d)("/users/check_exists/"+e).then(e=>{this.setState({user_exists:e.data.exists,id:e.data.exists?e.data.id:null,invite_button_disabled:!e.data.exists})}).catch(e=>{console.log(e)})},this.showModal=()=>{this.setState({modal_visiblity:"flex"},this.clearUsernameInput.bind(this))},this.clearUsernameInput=()=>{this.state.usernameInputRef.current.value="",this.state.usernameInputRef.current.focus(),this.setState({user_exists:!1,invite_button_disabled:!0})},this.hideModal=()=>{this.setState({modal_visiblity:"none",user_exists:!1,invite_button_disabled:!0})},this.sendInvite=()=>{this.state.id&&(console.log("send invite"),Object(o.d)("/users/profile/friends/add/"+this.state.id.toString()).then(()=>{this.hideModal()}).catch(()=>{this.hideModal()}))},this.state.usernameInputRef=n.a.createRef()}render(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"d-flex justify-content-center"},n.a.createElement(r.a,{variant:"dark",onClick:this.showModal.bind(this)},"Send Friend Request")),n.a.createElement("div",{className:"modal_add_friends_container",style:{display:this.state.modal_visiblity}},n.a.createElement("div",{className:"modal_add_friends"},n.a.createElement("div",{className:"modal_close",onClick:this.hideModal.bind(this)},"×"),n.a.createElement("div",null,"Username: ",n.a.createElement("input",{ref:this.state.usernameInputRef,type:"text",spellCheck:"false",onChange:this.onChange.bind(this),onKeyDown:this.handleKeyDown.bind(this)})),n.a.createElement("div",null,this.state.user_exists?"✔️":"❌"),n.a.createElement(r.a,{variant:"outline-dark",disabled:this.state.invite_button_disabled,onClick:this.sendInvite},"Send"))))}}class j extends n.a.Component{constructor(e){super(e),this.state={id:0,nick:"",clan:"",avatar:"",friends:[],party:[],party_leader:null},this.presence_ws=null,this.logOut=()=>{this.presence_ws.close(),localStorage.removeItem("token"),window.location.reload()},this._play=()=>{Object(o.d)("/test_notif/").then(()=>{})},this.updateFriendOnline=(e,t)=>{let a=this.state.friends;for(let s of a)if(s.id==e){s.is_online=t,s.last_seen=1;break}this.setState({friends:a})},this.updateFriendOnline=this.updateFriendOnline.bind(this),this.fetch_player_profile(),console.log("constructor called")}updateFriends(){console.log("update_friends"),Object(o.d)("/users/profile/friends/").then(e=>{this.setState({friends:e.data}),console.log(this.state.friends)}).catch(e=>{console.log(e.data)})}set_party(){Object(o.d)("/team").then(e=>{this.setState({party:e.data.members,party_leader:e.data.leader})}).catch(e=>{console.log(e)})}fetch_player_profile(){console.log("fetch start");const e=Object(o.e)("/team/"),t=Object(o.e)("/users/profile/friends/"),a=Object(o.e)("/users/profile/");console.log("fetch end"),this.state={party:e.members,party_leader:e.leader,friends:t,nick:a.username,clan:a.clan?a.clan.name:"No clan",avatar:a.avatar?a.avatar:"src/public/avatar.jpg",id:a.id},o.b.username=a.username,o.b.player_id=a.id,this.presence_ws=new WebSocket("ws://25.64.141.174:8769"),this.presence_ws.onopen=()=>{this.presence_ws.send(JSON.stringify(localStorage.getItem("token")))}}render(){return n.a.createElement("div",{className:"p-3 klamie rounded"},n.a.createElement("div",{className:"lobby_container"},n.a.createElement("div",{className:"left"},n.a.createElement("div",{className:"avatar_holder p-2"},n.a.createElement(i.a,{src:this.state.avatar,rounded:!0})),n.a.createElement("div",{className:"chat rounded"},n.a.createElement(w,null))),n.a.createElement("div",{className:"middle"},n.a.createElement("div",{className:"notifications"},n.a.createElement(f,{begin_game:this._play.bind(this),set_party:this.set_party.bind(this),update_friends:this.updateFriends.bind(this),player_id:this.state.id,update_friend:this.updateFriendOnline.bind(this)}))),n.a.createElement("div",{className:"right"},n.a.createElement("div",{className:"user_info"},n.a.createElement("div",{className:"d-flex justify-content-center shadow-sm p-2 rounded nick"},this.state.nick),n.a.createElement("div",{className:"d-flex justify-content-center shadow-sm p-2 rounded clan"},this.state.clan),n.a.createElement("div",{className:"d-flex justify-content-center mb-2"},n.a.createElement(r.a,{variant:"dark",size:"sm",onClick:this.logOut},"Log Out!"))),n.a.createElement("h2",{className:"d-flex justify-content-center"},"Party:"),n.a.createElement("div",{className:"lobby_team"},n.a.createElement(k,{party:this.state.party,leader:this.state.party_leader,user_nick:this.state.nick})),n.a.createElement("h2",{className:"d-flex justify-content-center"},"Friends:"),n.a.createElement(S,{nick:this.state.nick}),n.a.createElement("div",{className:"lobby_friends"},n.a.createElement(b,{friends:this.state.friends,update_friends:this.updateFriends.bind(this)})))),n.a.createElement("div",{className:"bottom"},n.a.createElement(r.a,{variant:"dark",size:"lg",onClick:this._play},"Play!")))}}t.default=Object(l.g)(j)},44:function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"d",(function(){return o})),a.d(t,"f",(function(){return c})),a.d(t,"e",(function(){return d})),a.d(t,"b",(function(){return m})),a.d(t,"c",(function(){return h}));var s=a(46),n=a.n(s),i=a(48),r=a.n(i);const l="http://25.64.141.174:8000/api/v1";function o(e){return n.a.get(l+e,{headers:{Authorization:"Token "+localStorage.getItem("token")}})}function c(e,t){return localStorage.getItem("token")?n.a.post(l+e,t,{headers:{Authorization:"Token "+localStorage.getItem("token")}}):n.a.post(l+e,t)}function d(e){return r()(l+e,{method:"GET",headers:{Authorization:"Token "+localStorage.getItem("token")}})}const m={username:"",player_id:-1},h={address:""}}}]);